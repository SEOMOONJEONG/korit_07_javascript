<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo List ì‹¤ìŠµ</title>
  <link rel="stylesheet" href="./01_todolist.css">
  <script src="./01_todolist.js" defer></script>
</head>
<body>
  <div class="todo-container">
    <h1>ë‚˜ì˜ Todo List</h1>
    <div class="input-group">
      <input type="text" id="todo-input" placeholder="ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•˜ì„¸ìš”.ğŸ‘">
      <button id="add-btn">ì¶”ê°€</button>
    </div>
    <ul id="todo-list" class="todo-list">
      <!-- ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ <li> íƒœê·¸ê°€ ì¶”ê°€ë˜ì–´ì•¼ í•¨. -->
        <!-- 
          ì´ê±°ë¶„ëª…íˆ htmlì— ìˆëŠ”ë° ìƒˆë¡œ ì¼œë³´ì‹œë©´ ì—†ì„ê²ë‹ˆë‹¤.
          ê·¸ ì´ìœ ëŠ” ì €í¬ê°€ ì²˜ìŒ ì‚¬ì´íŠ¸ì— ë“¤ì–´ê°€ê±°ë‚˜ í˜¹ì€ ìƒˆë¡œê³ ì¹¨ì„ í–ˆì„ ë•Œ
          renderTodos()ê°€ í˜¸ì¶œë˜ëŠ”ë°, ê·¸ ë•Œ localStorageì— ìˆëŠ” ê²ƒë“¤ë§Œ ë³´ì—¬ì£¼ê¸°ë¡œ ì½”ë“œë¥¼ ì‘ì„±í–ˆìœ¼ë‹ˆê¹Œìš”.
        -->
      <li class="todo-item">
        <input type="checkbox" class="completed">
        <span class="todo-text">todolist ë§Œë“¤ê¸°</span>
        <button class="delete-btn">ì‚­ì œ</button>
      </li>
    </ul>
  </div>
  <script>
    // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ë³€ìˆ˜ ì„ ì–¸ ë° ì´ˆê¸°í™”
    const todoInput = document.getElementById('todo-input');
    const addBtn = document.getElementById('add-btn');
    const todoList = document.getElementById('todo-list');

    // ì²˜ìŒ í˜ì´ì§€ì— ë“¤ì–´ê°”ì„ ë•Œ localStorageë¥¼ ì°¸ì¡°í•´ì„œ ê¸°ì¡´ todo ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê°€ì§€ê³  ì™€ì•¼ê² ë„¤ìš”.
    let todos = JSON.parse(localStorage.getItem('todos')) || [];

    // Todo ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
    function renderTodos() {
      // ê¸°ì¡´ todo listë¥¼ ì´ˆê¸°í™” â†’ ì¶”ê°€ í–ˆì„ ë•Œ ëˆ„ì  ì•ˆë˜ê²Œ
      todoList.innerHTML = '';

      // todos ë°°ì—´ì„ ë°˜ë³µ ëŒë ¤ì„œ ëª©ë¡ì„ ìƒì„±
      todos.forEach((todo, index) => {
        // todosì˜ ë°˜ë³µì„ ëŒë©´ ë‚´ë¶€ elementê°€ ìˆì„ê±´ë°, ê·¸ë•Œë§ˆë‹¤
        // li íƒœê·¸ë¥¼ ìƒì„±í•œë‹¤ëŠ” ì˜ë¯¸
        const li = document.createElement('li');
        // li íƒœê·¸ë§Œ ë§Œë“¤ì—ˆì§€ í´ë˜ìŠ¤ ì´ë¦„ ì•ˆì •í–ˆìœ¼ë‹ˆê¹Œ
        li.className = 'todo-item';
        if(todo.completed) {
          li.classList.add('completed');
        }

        // ì²´í¬ ë°•ìŠ¤ - input íƒœê·¸ë‹ˆê¹Œ
        const checkbox = document.createElement('input');
        // ê·¼ë° ì–˜ëŠ” typeì´ textê°€ ì•„ë‹ˆë¼ checkboxë‹ˆê¹Œ
        checkbox.type = 'checkbox';
        checkbox.checked = todo.completed;

        // í…ìŠ¤íŠ¸ ë‚´ìš© ìƒì„± - spaníƒœê·¸
        const span = document.createElement('span');
        span.className = 'todo-text';
        span.textContent = todo.text;

        // ì‚­ì œ ë²„íŠ¼ - button íƒœê·¸
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.innerHTML = '&times';   // x ê¸°í˜¸

        // ìš”ì†Œë“¤ì„ li ë³€ìˆ˜ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. ì™œ? li ë‚´ë¶€ì— ì²´í¬ë°•ìŠ¤ / ìŠ¤íŒ¬ / ë²„íŠ¼
        li.append(checkbox);
        li.append(span);
        li.append(deleteBtn);

        // ê·¸ë¦¬ê³  ì´ lië¥¼ <ul> íƒœê·¸ì— ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.
        todoList.appendChild(li);

        // ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
        checkbox.addEventListener('change', () => {
          todos[index].completed = checkbox.checked;  // checkboxê°€ typeì´ê³ , checkedëŠ” ì†ì„±ì— í•´ë‹¹
          // ì™„ë£Œ ìƒíƒœì— ë”°ë¼ CSS í´ë˜ìŠ¤ë¥¼ í† ê¸€
          li.classList.toggle('completed', checkbox.checked);
          saveTodos();
        });

        // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        deleteBtn.addEventListener('click', () => {
          // ì‚­ì œí•  í•­ëª©ì˜ í…ìŠ¤íŠ¸ë¥¼ ì´ìš©í•´ì„œ ë°°ì—´ ë‚´ì—ì„œ ì •í™•í•œ ì¸ë±ìŠ¤ë¥¼ ì°¾ì•„ë‚¼ê²ë‹ˆë‹¤.
          // ë³´í†µì€ indexë¡œ ë‚´ìš©ì„ í™•ì¸í•˜ì§€ë§Œ ê³„ì† ì‚­ì œë¥¼ í•˜ë©´ index ë„˜ë²„ê°€ ë°”ë€Œê² ì£ 
          // ê·¸ë˜ì„œ inputì— ì…ë ¥í–ˆë˜ ë‚´ìš©ì„ ê·¼ëŸ¬ë¡œ indexë¥¼ ì—­ìœ¼ë¡œ ì°¾ì•„ë‚¼ ì˜ˆì •ì…ë‹ˆë‹¤.
          const itemText = span.textContent;  // ì–˜ë¥¼ ì“°ëŠ” ì´ìœ ëŠ” ì €í¬ê°€ .trim() ì“°ëŠ” ë°”ëŒì— ê³µë°±ì„ ë‚ ë ¸ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

          // ë°°ì—´ ë‚´ì—ì„œì˜ ë‚´ìš©ê³¼ span íƒœê·¸ ë‚´ì—ì„œì˜ ë‚´ìš©ì´ ê°™ì€ indexë¥¼ ë½‘ì•„ë‚´ì„œ itemIndex ë³€ìˆ˜ì— ì €ì¥
          const itemIndex = todos.findIndex(item => item.text === itemText);

          if (itemIndex !== -1) { // ì¼ì¹˜í•˜ëŠ” ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë©´ -1
            todos.splice(itemIndex, 1); // itemIndexì— í•´ë‹¹í•˜ëŠ” ê±° element í•˜ë‚˜ë¥¼ ì‚­ì œ
            li.remove();
            saveTodos();
          }
        });
      });
    }

    function saveTodos() {
      // localStorageì— ì €ì¥í•œë‹¤ëŠ” ì˜ë¯¸ì˜€ìœ¼ë‹ˆê¹Œ,
      localStorage.setItem('todos', JSON.stringify(todos));
    }

    function addTodo() {
      const todoText = todoInput.value.trim();   // trim() ê³µë°± ì œê±° method
      if(todoText === '') {
        alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” !');
        return;
      }

      // input ì°½ì— ë‚´ìš©ì´ ìˆë‹¤ë©´ ë‚´ìš©ì´ ë“¤ì–´ê°ˆ JS ê°ì²´ ì„ ì–¸
      const newTodo = {
        text: todoText,
        completed: false,
      };

      // todosì— ìƒˆë¡œìš´ todoë¥¼ ì¶”ê°€
      todos.push(newTodo);

      // ì¶”ê°€í•œ ì´í›„ì— input íƒœê·¸ ë‚´ì˜ ë‚´ìš©ì„ ë¹„ìš°ëŠ” ì—­í• 
      todoInput.value = '';

      renderTodos();
      saveTodos();
    }

    // 'ì¶”ê°€' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    addBtn.addEventListener('click', addTodo);

    // ì—”í„° í‚¤ ì…ë ¥ ì´ë²¤íŠ¸
    todoInput.addEventListener('keydown', (event) => {
      if(event.key === 'Enter') {
        addTodo();    // input íƒœê·¸ì— Enterí‚¤ ì…ë ¥ì„ ê°ì§€í•˜ë©´ addTodo(); í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ê²ƒ
      }
    });
    
    // ìƒˆë¡œê³ ì¹¨í–ˆì„ ë•Œ renderTodos()ê°€ í˜¸ì¶œë˜ì–´ì•¼ í•¨.
    window.onload = renderTodos();
  </script>
</body>
</html>